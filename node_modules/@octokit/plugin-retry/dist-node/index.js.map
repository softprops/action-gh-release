{"version":3,"file":"index.js","sources":["../dist-src/error-request.js","../dist-src/wrap-request.js","../dist-src/index.js"],"sourcesContent":["// @ts-ignore\nexport async function errorRequest(octokit, state, error, options) {\n    if (!error.request || !error.request.request) {\n        // address https://github.com/octokit/plugin-retry.js/issues/8\n        throw error;\n    }\n    // retry all >= 400 && not doNotRetry\n    if (error.status >= 400 && !state.doNotRetry.includes(error.status)) {\n        const retries = options.request.retries != null ? options.request.retries : state.retries;\n        const retryAfter = Math.pow((options.request.retryCount || 0) + 1, 2);\n        throw octokit.retry.retryRequest(error, retries, retryAfter);\n    }\n    // Maybe eventually there will be more cases here\n    throw error;\n}\n","// @ts-ignore\nimport Bottleneck from \"bottleneck/light\";\n// @ts-ignore\nexport async function wrapRequest(state, request, options) {\n    const limiter = new Bottleneck();\n    // @ts-ignore\n    limiter.on(\"failed\", function (error, info) {\n        const maxRetries = ~~error.request.request.retries;\n        const after = ~~error.request.request.retryAfter;\n        options.request.retryCount = info.retryCount + 1;\n        if (maxRetries > info.retryCount) {\n            // Returning a number instructs the limiter to retry\n            // the request after that number of milliseconds have passed\n            return after * state.retryAfterBaseValue;\n        }\n    });\n    return limiter.schedule(request, options);\n}\n","import { errorRequest } from \"./error-request\";\nimport { wrapRequest } from \"./wrap-request\";\nexport const VERSION = \"3.0.2\";\nexport function retry(octokit, octokitOptions = {}) {\n    const state = Object.assign({\n        enabled: true,\n        retryAfterBaseValue: 1000,\n        doNotRetry: [400, 401, 403, 404, 422],\n        retries: 3,\n    }, octokitOptions.retry);\n    octokit.retry = {\n        retryRequest: (error, retries, retryAfter) => {\n            error.request.request = Object.assign({}, error.request.request, {\n                retries: retries,\n                retryAfter: retryAfter,\n            });\n            return error;\n        },\n    };\n    if (!state.enabled) {\n        return;\n    }\n    octokit.hook.error(\"request\", errorRequest.bind(null, octokit, state));\n    octokit.hook.wrap(\"request\", wrapRequest.bind(null, state));\n}\nretry.VERSION = VERSION;\n"],"names":["errorRequest","octokit","state","error","options","request","status","doNotRetry","includes","retries","retryAfter","Math","pow","retryCount","retry","retryRequest","wrapRequest","limiter","Bottleneck","on","info","maxRetries","after","retryAfterBaseValue","schedule","VERSION","octokitOptions","Object","assign","enabled","hook","bind","wrap"],"mappings":"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"}